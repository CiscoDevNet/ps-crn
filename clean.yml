- name: Configure licensing
  hosts: firewall:&virl_hosts
  gather_facts: no
  connection: network_cli
  tasks:
    - name: Deregister from smart account
      asa_command:
        commands:
          - "license smart deregister"

- hosts: localhost
  connection: local
  gather_facts: no
  tasks:
  - name: Find previsouly created certs
    find:
      paths: "{{ viptela_cert_dir }}"
      patterns: '*.pem,*.key,*.csr,*.crt'
    register: find_results

  - name: Delete previsouly created certs
    file:
      path: "{{ item['path'] }}"
      state: absent
    with_items: "{{ find_results['files'] }}"

  - name: Clean the current topology
    include_role:
      name: ansible-virl
      tasks_from: clean